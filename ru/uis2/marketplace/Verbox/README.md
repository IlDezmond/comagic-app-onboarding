### Интеграция с Verbox: передача чатов и заявок
<br />

**Ценность**  <br />

Интеграция с Verbox позволяет передавать в CoMagic/UIS чаты с онлайн виджета , а также заявки с офлайн формы, для дальнейшего построения Сквозной аналитики. <br />


**Функционал интеграции** <br />  
- Передача чатов из виджета онлайн чата Verbox в CoMagic, c рекламным источником, по которому посетитель перешел на сайт. 
- Передача чатов  с остальных каналов (мессенджеры, соц. сети и др), интегрированных с Verbox. 
Общение в данных каналах происходит напрямую, без перехода через сайт, поэтому обращения из них мы можем складывать только в заранее созданные рекламные кампании.
- Передача оффлайн заявок  в режиме реального времени   с offline формы чата Verbox в CoMagic, c рекламным источником, по которому посетитель перешел на сайт. 
<br />


 **Какие данные передаются**<br />
  
- контактные данные (имя,телефон,email);  
- дату и время создания;  
- текст чата;
- данные сессии (рекламную кампанию, источник, UTM-метки и тд);  
- в случае отсутствия сессии, дефолтную РК или источник.
<br />

**Необходимые компоненты для работы интеграции**<br />  
- Загрузка чатов из внешней системы в нашем ЛК.
- Загрузка оффлайн-заявок из внешней системы.
<br />

### Подключение интеграции <br />

Интеграция подключается в несколько шагов: <br />

1. Нажмите "Активен" на этой странице. <br />
2. Выполните настройку интеграции. <br />

- **Настройте Webhook в Verbox**<br />

<details>
  <summary style="font-weight:bold;"> Подробнее </summary> <br />

  - **Webhook url для чатов** <br />
      - Зайдите в Verbox в настройки сайта (по каждому сайту настройка производится отдельно). 
      - Найдите раздел События и выберете "Диалог завершен".
      - Добавьте обработчик, в нем добавьте действие "Webhook".
      - В URL хука укажите значение из поля "Webhook url для чатов ".
      - Сохраните обработчик и активируйте его. <br />

      ![image](verbox_chat.gif)

  - **Передавать offline заявки** — прожмите переключатель, если необходимо передавать offline заявки с формы offline вопроса. После прожатия появится отдельный URL для offline заявок <br />
  
  - **Webhook url для offline заявок** <br />
      - Зайдите в Verbox в настройки сайта (по каждому сайту настройка производится отдельно) 
      - Найдите раздел События и выберете "Новый оффлайн вопрос"
      - Добавьте обработчик, в нем добавьте действие "Webhook"
      - В URL хука укажите значение из поля "Webhook url для offline заявок "
      - Сохраните обработчик и активируйте его    <br />  

      ![image](verbox_offline.gif)


</details> 
<br /> 

- В разделе **Сотрудник**  выбираем сотрудника на которого будут назначаться полученные чаты.  
- Через переключатель **Рекламная кампания/Источник** выбираем сущность в которую будут передаваться наши чаты без РК.
- В зависимости от положения переключателя "Рекламная кампания/источник" выводится либо список рекламных кампаний из личного кабинета клиента, либо список источников и сайтов. Необходимо указать какую **Рекламную кампанию/источник и сайт** используем в случае отсутствия сессии.
- В разделе **Соответствие мессенджеров и источников** настраиваем в какую РК/Источник будут попадать чаты из мессенджеров с неопределившейся сессией.  

<br />

3. Нажмите сохранить.<br />
4. После сохранения будет выведен скрипт, который необходимо установить на сайт в соответствие с описанием в настройках.<br />


После подключения интеграции заявки будут попадать в  Сырые данные -> Обращения и цели. <br />  
Для проверки корректности работы интеграции оставьте тестовое обращение в чате Verbox.

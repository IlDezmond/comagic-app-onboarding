### Интеграция с RetailCRM <br />

**Ценность** <br />

Решение позволяет передавать в наш кабинет данные по сделкам, для дальнейшего построения Сквозной аналитики, а также интегрировать функционал телефонии и передавать данные по звонкам в RetailCRM. <br /> 

**Какие данные передаются** <br />

Данные получаемые по сделкам:    <br />
- сделки: сумма сделки, статус, магазин, к которому относится сделка и тд; 
- воронка продаж и ее этапы;
- контакты;
- ответственный менеджер.   <br />

Данные передаваемые по звонкам:  <br />

- всплывающие уведомления о входящих звонках;
- звонок в один клик из RetailCRM;
- сохранение истории и записей звонков в RetailCRM. <br />

<br />
<br />
<br />
<br />

## Подключение передачи сделок   <br />


<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />

1. Укажите **Учетные данные** <br />

- нажать "Авторизация";
- если ранеее добавляли учетные данные RetailCRM, то выбрать их из списка; <br /> 
- если нет, то нажать "Добавить учетные данные" и заполнить значения:
  - название; <br />
  - URL (домен RetailCRM ) в формате https://shop472.retailcrm.ru/ , часть 'shop472' у каждого клиента уникальна; 
  - API key - ключ API RetailCRM, Настройки - > Интеграция → Ключи доступа к API -> Добавить  <br />
  Создаем новый ключ, с доступом ко всем магазинам и методам. Добавляем данный ключ в настройки интеграции.  <br />

![image](retailcrm_auth.gif)  <br />

      
После добавления учетных данных на странице появятся Параметры интеграции.  <br />

2. Нажмите **Активен** на этой странице. <br />

3. **Настройте Триггер в RetailCRM** <br />

<details>
  <summary style="font-weight:bold;"> Подробнее </summary> <br />

Автоматизация → Триггеры →  Добавить триггер <br />
Заполните настройки триггера:

- название ;
- добавляем событие 'Изменение заказа ': 
  - обязательно указываем в условиях:  "Новый заказ" или  "Изменение статуса заказа с Любой на Любой" или "Заказ оплачен "Да";
  - в действие добавляем "Выполнить HTTP-запрос"  , в нем заполняем настройки :
     - Адрес  - Webhook url из настроек интеграции;
     - HTTP метод - GET;
     - Передавать параметры - в строке запроса; 
        - Параметр: orderId 
        - Значение: {{ order.id }} <br />

![image](retail_trigger_3.gif)

</details> 

<br />
 
4. Проставьте требуемые настройки: <br />
- **Дефолтная воронка** — при прожатии все сделки будут передаваться в 1 воронку по умолчанию. В противном случае по каждом магазину будет создана отдельная воронка. <br />
- **Учитывать стоимость доставки** — при прожатии в сумму сделки будет включена стоимость доставки. <br />

5. Нажмите сохранить. <br />


После подключения интеграции сделки будут попадать в  Сырые данные -> Сделки.  <br />
Для проверки корректности работы интеграции создайте тестовую сделку в RetailCRM.

</details> 


<br />
<br />
<br />
<br />
<br />
<br />
<br />

## Подключение телефонии   <br />

<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />
  
1. Укажите **Учетные данные** <br />

- нажать "Авторизация";
- если ранеее добавляли учетные данные RetailCRM, то выбрать их из списка; <br /> 
- если нет, то нажать "Добавить учетные данные" и заполнить значения:
  - название; <br />
  - URL (домен RetailCRM ) в формате https://shop472.retailcrm.ru/ , часть 'shop472' у каждого клиента уникальна; 
  - API key - ключ API RetailCRM, Настройки - > Интеграция → Ключи доступа к API -> Добавить  <br />
  Создаем новый ключ, с доступом ко всем магазинам и методам. Добавляем данный ключ в настройки интеграции.  <br />

![image](retailcrm_auth.gif)  <br />

      
После добавления учетных данных на странице появятся Параметры интеграции.  <br />

2. Нажмите **Активен** на этой странице. <br />
3. **Фильтровать по виртуальным номерам** - выберите настройку, если требуется  фильтрация по виртуальным номерам (в случае подключения нескольких сетей/интеграций). <br />
При прожатии будет выведена дополнительная настройка с выбором виртуальных номеров. <br />

**Список виртуальных номеров** - укажите виртуальные номера, по которым необходимо отображать данные по звонкам в Мегаплан в подключенной сети. <br />
4. **Создавать контакт при звонке** - настройка позволяет создавать контакт в разделе "Клиенты" при начале разговора. <br />

При её выборе выводится дополнительные настройки: <br /> 
- **Назначать ответственного на** - выберете кого назначать ответственным за успешный звонок от нового клиента (последний или первый разговаривавший). <br />
- **Ответственный по умолчанию** - если звонок потерян или поступил на сотрудника, который отсутствует в RetailCRM, то выбранный сотрудник будет назначен ответственным при автоматическом создании контакта.<br />
5. **Сотрудники** - 
  **Добавочные коды сотрудников** - укажите соответствие сотрудников из RetailCRM и их добавочных кодов, заданных в нашем кабинете (внутренние номера).  <br />
6. **Внешние номера магазинов** - укажите соответствие магазинов из RetailCRM и их внешних номеров (виртуальные номера). <br />
7. Нажмите сохранить. <br />
При подключении интеграции в нашем ЛК, автоматически подключается приложение в Маркетплейсе в RetailCRM.<br />
Для проверки работы интеграции на тестовых звонках проверьте работу пунктов указаных в **"Данные передаваемые по звонкам"**. <br />


</details> 


### Интеграция с RetailCRM <br />

**Ценность** <br />

Решение позволяет передавать в наш кабинет данные по сделкам, для дальнейшего построения Сквозной аналитики. <br />

**Какие данные передаются** <br />

- сделки: сумма сделки, статус, магазин, к которому относится сделка и тд; 
- воронка продаж и ее этапы;
- контакты;
- ответственный менеджер.   <br />

**Необходимые компоненты для работы интеграции**  <br />
- Сквозная аналитика. <br />

### Подключение интеграции <br />

Интеграция подключается в несколько шагов: <br />

1. Нажмите "Активен" на этой странице. <br />
2. Заполните поля/проставьте требуемые маркеры в настройках.  <br />

- **Авторизация в RetailCRM** <br />

<details>
  <summary style="font-weight:bold;"> Подробнее </summary> <br />
 
Добавьте:
- URL (домен RetailCRM ) в формате https://shop472.retailcrm.ru/ , часть 'shop472' у каждого клиента уникальна
- API key - ключ API RetailCRM, Настройки - > Интеграция → Ключи доступа к API -> Добавить
Создаем новый ключ, с доступом ко всем магазинам и методам. Добавляем данный ключ в настройки интеграции.

![image](retailcrm_auth.gif)

</details> 
<br />

- **Настройте Триггер в RetailCRM** <br />

<details>
  <summary style="font-weight:bold;"> Подробнее </summary> <br />

Автоматизация → Триггеры →  Добавить триггер <br />
Заполните настройки триггера:

- название ;
- добавляем событие 'Изменение заказа ': 
  - обязательно указываем в условиях:  "Новый заказ" или  "Изменение статуса заказа с Любой на Любой" или "Заказ оплачен "Да";
  - в действие добавляем "Выполнить HTTP-запрос"  , в нем заполняем настройки :
     - Адрес  - Webhook url из настроек интеграции;
     - HTTP метод - GET;
     - Передавать параметры - в теле запроса;  <br />
        - Параметр: orderId  <br />
        - Значение: {{ order.id }} <br />

![image](retail_trigger_2.gif)

</details> 

<br />
 
**Переключатели:** <br />
- **Дефолтная воронка** - при прожатии все сделки будут передаваться в 1 воронку по умолчанию. В противном случае по каждом магазину будет создана отдельная воронка. <br />
- **Учитывать стоимость доставки** - при прожатии в сумму сделки будет включена стоимость доставки. <br />

3. Нажмите сохранить. <br />


После подключения интеграции сделки будут попадать в  Сырые данные -> Сделки.  <br />
Для проверки корректности работы интеграции создайте тестовую сделку в RetailCRM.

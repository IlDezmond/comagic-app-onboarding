### CarrotQuest. Передача чатов  
<br>

**Ценность интеграции**  
Интеграция позволяет получать данные по чатам в наш кабинет для построение аналитики.  
<br>

**Возможности интеграции**  
1. Передача чатов из виджета CarrotQuest.  
2. Передача чатов мессенджеров из виджета CarrotQuest.  
3. Принудительная загрузка чатов в одну настроенную РК или источник.  
<br>

**Какие данные передаются**  
- контактные данные (имя,телефон,email).  
- дата и время создания.  
- данные сессии (рекламную кампанию, источник, UTM-метки и тд).  
- в случае отсутствия сессии, дефолтную РК или источник.  
<br>

  **Необходимые компоненты для работы интеграции**  
- Загрузка чатов из внешней системы.
<br>

**Настройка интеграции**  
1. Нажмите "Активен" на этой странице.
2. Настройте Webhook в CarrotQuest

<details>
  <summary style="font-weight:bold;"> Подробнее </summary> <br />
 
В CarrotQuest необходимо настроить Webhook на "Webhook url" сервиса CoMagic/UIS из настроек.<br />  
a. Заходим в  CarrotQuest в раздел Интеграции -> Интеграции своими руками , создаем интеграцию Webhooks.<br />  
b. В поле URL вставляем скопированный адрес, в поле "События" выбираем "Вопрос диалога разрешен".<br /> 
c. Нажимаем "Сохранить". <br /> 
 
![image](Carrot_hook.gif)  

**Важно:** по умолчанию, вопрос завершенным считается спустя 60 минут, после закрытия чата, соотвественно и хуки в наше решение будут уходить не сразу, а спустя час.<br /> 
Данную настройку можно поменять в Настройки -> Общие настройки -> Чат -> Завершение диалогов в чате -> Время, после которого вопрос станет решённым. <br />


</details> 
<br /> 

3. **Авторизация в CarrotQuest** <br />
В поле Ваш ключ API CarrotQuest вводим ключ АПИ CarrotQuest. <br />

![image](Carrot_Auth.jpg) <br />
Как получить ключ АПИ в CarrotQuest.  <br />
Настройки -> Разработчикам -> Создать новый <br />

![image](Carrot_Api_key.gif) <br />
<br /> 

4. В поле **Сотрудник по умолчанию** выбираем сотрудника на которого будут назначаться чаты.
5. **Тип трафика** — необходимо выбрать какую сущность использовать для обращений без сессии.<br />

- В зависимости от выбранного типа трафика выводится либо список источников и сайтов  из личного кабинета клиента, либо список рекламных кампаний. Необходимо указать какой источник и сайт/рекламную кампанию используем в случае  отсутствия сессии. <br /> 
- В разделе **Сопоставление источников/Сопоставление рекламных кампаний** выбираем сопоставление каналов мессенджеров с Рекламными кампаниями/Источниками.  <br />

6. **Тегировать обращения** — при прожатии появится возможность выбрать тег, который будет ставится на все чаты интеграции.<br />
7. Нажмите сохранить. <br />
8. После сохранения будет выведен скрипт, который необходимо установить в разделе  Интеграции -> Интеграции своими руками CarrotQuest.
<details>
  <summary style="font-weight:bold;"> Настройте JS Script в CarrotQuest </summary> <br />
В CarrotQuest необходимо настроить JS Script сервиса CoMagic/UIS из настроек.<br />  
a. Заходим в  CarrotQuest в раздел Интеграции -> Интеграции своими руками , создаем интеграцию JS Script.<br />  
b. В поле "Скрипт" вставляем скопированный скрипт.<br /> 
c. Нажимаем "Сохранить".
![image](Carrot_JS.gif)  
</details> 
<br />

Для проверки работы интеграции оставьте тестовый чат и проверьте его попадание в личный кабинет.  
